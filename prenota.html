<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prenotazioni – Altrove Leukerbad</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/customParseFormat.js"></script>
  <script>dayjs.extend(window.dayjs_plugin_customParseFormat);</script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 2rem;
      background: #f2f2f2;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input, select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .counter {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    .counter button {
      width: 30px;
      height: 30px;
      font-size: 1.2rem;
      border: none;
      background: #ccc;
      cursor: pointer;
    }
    .results {
      margin-top: 2rem;
      background: #f9f9f9;
      padding: 1rem;
      border-radius: 12px;
    }
    .results span {
      display: block;
      margin: 0.3rem 0;
    }
    button.submit {
      margin-top: 2rem;
      padding: 1rem;
      background: #333;
      color: white;
      width: 100%;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Prenota il tuo soggiorno</h2>

  <label for="fullname">Nome e Cognome:</label>
  <input type="text" id="fullname" required>

  <label for="email">Email:</label>
  <input type="email" id="email" required>

  <label for="daterange">Date del soggiorno:</label>
  <input type="text" id="daterange" required>

  <div class="counter">
    <label>Adulti (16+):</label>
    <button type="button" onclick="changeCount('adults', -1)">–</button>
    <span id="adults">2</span>
    <button type="button" onclick="changeCount('adults', 1)">+</button>
  </div>

  <div class="counter">
    <label>Ragazzi (6–16):</label>
    <button type="button" onclick="changeCount('teens', -1)">–</button>
    <span id="teens">0</span>
    <button type="button" onclick="changeCount('teens', 1)">+</button>
  </div>

  <div class="counter">
    <label>Bambini (0–6):</label>
    <button type="button" onclick="changeCount('kids', -1)">–</button>
    <span id="kids">0</span>
    <button type="button" onclick="changeCount('kids', 1)">+</button>
  </div>

  <div class="results">
    <span>Prezzo medio per notte: <strong id="priceNight">CHF 0</strong></span>
    <span>Prezzo appartamento: <strong id="apt">CHF 0</strong></span>
    <span>Tassa soggiorno: <strong id="tax">CHF 0</strong></span>
    <span>Costi pulizia: <strong>CHF 120</strong></span>
    <span>Totale soggiorno: <strong id="total">CHF 0</strong></span>
  </div>

  <button class="submit" onclick="calculate()">Calcola Totale</button>
</div>

<script>
let counts = { adults: 2, teens: 0, kids: 0 };
const cleaning = 120;

const priceRanges = [
  { from: '04-07', to: '05-31', price: 110 },
  { from: '06-01', to: '06-30', price: 130 },
  { from: '07-01', to: '08-31', price: 160 },
  { from: '09-01', to: '09-30', price: 130 },
  { from: '10-01', to: '12-15', price: 110 },
  { from: '12-16', to: '12-20', price: 220 },
  { from: '12-21', to: '01-08', price: 350 },
  { from: '01-09', to: '04-06', price: 220 }
];

function changeCount(type, delta) {
  counts[type] = Math.max(0, counts[type] + delta);
  document.getElementById(type).innerText = counts[type];
}

function getPriceForDate(date) {
  const mmdd = dayjs(date).format('MM-DD');
  const season = priceRanges.find(p => mmdd >= p.from && mmdd <= p.to);
  return season ? season.price : 0;
}

function calculate() {
  const picker = document.getElementById('daterange')._litepicker;
  if (!picker) return;

  const start = dayjs(picker.getStartDate().format('YYYY-MM-DD'));
  const end = dayjs(picker.getEndDate().format('YYYY-MM-DD'));
  const nights = end.diff(start, 'day');

  if (isNaN(nights) || nights < 2) {
    alert("Soggiorno minimo 2 notti");
    return;
  }

  let totalApt = 0;
  for (let d = start.clone(); d.isBefore(end); d = d.add(1, 'day')) {
    totalApt += getPriceForDate(d);
  }

  const avgNight = Math.round(totalApt / nights);
  const tax = (counts.adults * 6 + counts.teens * 3) * nights;
  const total = totalApt + tax + cleaning;

  document.getElementById("priceNight").innerText = `CHF ${avgNight}`;
  document.getElementById("apt").innerText = `CHF ${totalApt}`;
  document.getElementById("tax").innerText = `CHF ${tax}`;
  document.getElementById("total").innerText = `CHF ${total}`;
}

new Litepicker({
  element: document.getElementById('daterange'),
  singleMode: false,
  numberOfMonths: 2,
  numberOfColumns: 2,
  format: 'YYYY-MM-DD',
  setup: (picker) => {
    picker.on('selected', () => calculate());
  }
});
</script>
</body>
</html>
